-- Migration: create_vendor_tables
-- Created at: 1755792746

-- Create vendor database schema for Shopify integration

-- Vendors table (for managing vendor information)
CREATE TABLE IF NOT EXISTS vendors (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    name VARCHAR(255) NOT NULL,\n    email VARCHAR(255),\n    website VARCHAR(255),\n    status VARCHAR(50) DEFAULT 'active',\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()\n);\n\n-- Vendor products table (stores Shopify product data)\nCREATE TABLE IF NOT EXISTS vendor_products (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    shopify_product_id BIGINT UNIQUE NOT NULL,\n    handle VARCHAR(255),\n    title TEXT NOT NULL,\n    body_html TEXT,\n    vendor VARCHAR(255),\n    product_type VARCHAR(255),\n    status VARCHAR(50) DEFAULT 'active',\n    tags TEXT[],\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()\n);\n\n-- Vendor variants table (stores Shopify variant data)\nCREATE TABLE IF NOT EXISTS vendor_variants (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    shopify_variant_id BIGINT UNIQUE NOT NULL,\n    shopify_product_id BIGINT NOT NULL REFERENCES vendor_products(shopify_product_id) ON DELETE CASCADE,\n    sku VARCHAR(255),\n    barcode VARCHAR(255),\n    price DECIMAL(10,2) DEFAULT 0,\n    compare_at_price DECIMAL(10,2),\n    position INTEGER DEFAULT 1,\n    inventory_item_id BIGINT,\n    option1 VARCHAR(255),\n    option2 VARCHAR(255),\n    option3 VARCHAR(255),\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()\n);\n\n-- Vendor images table (stores Shopify image data)\nCREATE TABLE IF NOT EXISTS vendor_images (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    shopify_image_id BIGINT UNIQUE NOT NULL,\n    shopify_product_id BIGINT NOT NULL REFERENCES vendor_products(shopify_product_id) ON DELETE CASCADE,\n    src TEXT NOT NULL,\n    alt TEXT,\n    position INTEGER DEFAULT 1,\n    width INTEGER,\n    height INTEGER,\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()\n);\n\n-- Vendor inventory levels table (stores inventory data)\nCREATE TABLE IF NOT EXISTS vendor_inventory_levels (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    inventory_item_id BIGINT UNIQUE NOT NULL,\n    location_id BIGINT,\n    available INTEGER DEFAULT 0,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()\n);\n\n-- Vendor import decisions table (tracks which products to import)\nCREATE TABLE IF NOT EXISTS vendor_import_decisions (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    shopify_product_id BIGINT UNIQUE NOT NULL REFERENCES vendor_products(shopify_product_id) ON DELETE CASCADE,\n    decision VARCHAR(50) DEFAULT 'none', -- 'none', 'staged', 'imported', 'skipped'\n    decided_at TIMESTAMP WITH TIME ZONE,\n    decided_by UUID,\n    notes TEXT,\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()\n);\n\n-- Product overrides table (for customizing product data before import)\nCREATE TABLE IF NOT EXISTS product_overrides (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    shopify_product_id BIGINT UNIQUE NOT NULL REFERENCES vendor_products(shopify_product_id) ON DELETE CASCADE,\n    title_override VARCHAR(255),\n    description_override TEXT,\n    category_override VARCHAR(255),\n    price_override DECIMAL(10,2),\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()\n);\n\n-- Vendor communications table (for tracking interactions)\nCREATE TABLE IF NOT EXISTS vendor_communications (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    vendor_id UUID REFERENCES vendors(id) ON DELETE CASCADE,\n    communication_type VARCHAR(50), -- 'email', 'phone', 'meeting', 'note'\n    subject VARCHAR(255),\n    content TEXT,\n    status VARCHAR(50) DEFAULT 'sent',\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()\n);\n\n-- Vendor product relationships table (for linking vendor products to main catalog)\nCREATE TABLE IF NOT EXISTS vendor_product_relationships (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    shopify_product_id BIGINT NOT NULL REFERENCES vendor_products(shopify_product_id) ON DELETE CASCADE,\n    main_product_id UUID, -- References main products table\n    relationship_type VARCHAR(50) DEFAULT 'imported', -- 'imported', 'linked', 'variant'\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()\n);\n\n-- Create indexes for better performance\nCREATE INDEX IF NOT EXISTS idx_vendor_products_shopify_id ON vendor_products(shopify_product_id);\nCREATE INDEX IF NOT EXISTS idx_vendor_variants_shopify_id ON vendor_variants(shopify_variant_id);\nCREATE INDEX IF NOT EXISTS idx_vendor_variants_product_id ON vendor_variants(shopify_product_id);\nCREATE INDEX IF NOT EXISTS idx_vendor_images_product_id ON vendor_images(shopify_product_id);\nCREATE INDEX IF NOT EXISTS idx_vendor_inventory_item_id ON vendor_inventory_levels(inventory_item_id);\nCREATE INDEX IF NOT EXISTS idx_vendor_decisions_product_id ON vendor_import_decisions(shopify_product_id);\nCREATE INDEX IF NOT EXISTS idx_product_overrides_product_id ON product_overrides(shopify_product_id);;